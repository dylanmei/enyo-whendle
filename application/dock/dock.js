(function() {  var dock = {    name: "Dock",    kind: "VFlexBox",    components: [      { name: 'overlay', className: 'dimness' },      { kind: 'SlippyMap', name: 'map' },      { name: 'clock', className: 'clock', components: [        { name: 'time', className: 'time' },        { name: 'date', className: 'date' }      ]},      { name: 'toolbar', kind: 'Toolbar', pack: 'justify', components: [        { flex: 1 },        { name: 'dimmer',          kind: 'Dimmer',          maximum: 0.90,          position: 0.0,          onChanged: 'dimmerHandler',          onChanging: 'dimmerHandler'        },        { flex: 1 }      ]},      { kind: 'Preferences', name: 'preferences', onLoad: 'preferencesHandler' }    ],    create: function() {      this.inherited(arguments);      _.observe('clock:tick',        _.bind(on_clock_tick, this));      _.defer(Timekeeping.tick);      this.time_formatter = new enyo.g11n.DateFmt({time:'short'});      this.date_formatter = new enyo.g11n.DateFmt({format:'EEEE, MMMM d'});      enyo.setAllowedOrientation("landscape");    },    rendered: function() {      this.inherited(arguments);      var node = this.hasNode(),          latitude = 37.6,          longitude = 0;      this.$.map        .zoom(2)        .pan(latitude, longitude)        .size(node.offsetWidth, node.offsetHeight);    },    preferencesHandler: function() {      var dimness = this.$.preferences.getDockDimness();      if (dimness || dimness == 0) {        this.$.dimmer.setPosition(dimness);        on_dimness_changed.call(this, dimness);      }    },    clickHandler: function(sender, e) {      var toolbar = this.$.toolbar;      var container = sender.container;      while (container) {        if (container == toolbar) return true;        container = container.container;      }      if (toolbar.hasClass('show-toolbar'))        hide_the_toolbar.call(this);      else {        toolbar.addClass('show-toolbar');        defer_hiding_the_toolbar.call(this);      }    },    dimmerHandler: function(sender, value) {      defer_hiding_the_toolbar.call(this);      on_dimness_changed.call(this, value);    }  };  function on_dimness_changed(value) {      var text_brightness = 1 - (value / 2);      this.$.clock.applyStyle('opacity', text_brightness);      this.$.overlay.applyStyle('opacity', value);  }  function on_clock_tick(e) {    if (e.declination !== undefined)      this.$.map.time(e.now, e.declination);    var local = e.now      .add((e.offset).minutes);    this.$.time.setContent(      this.time_formatter.format(local)    );    this.$.date.setContent(      this.date_formatter.format(local)    );  }  function defer_hiding_the_toolbar() {    if (this.timer) clearTimeout(this.timer);    this.timer = setTimeout(      _.bind(hide_the_toolbar, this), (5).seconds);  }  function hide_the_toolbar() {    var dimmer = this.$.dimmer;    var toolbar = this.$.toolbar;    if (this.timer) clearTimeout(this.timer);    delete this.timer;    this.$.preferences.setDockDimness(      dimmer.position    );    toolbar.addClass('hide-toolbar');    toolbar.removeClass('show-toolbar');  }  enyo.kind(dock);})();